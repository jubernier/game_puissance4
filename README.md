# projet-puissance4

Groupe : Basma Malki & Justine Bernier

### Installation

- `git clone https://github.com/basma-malki/projet-puissance4.gitè
- Allons dans le dossier racine du projet, puis,
- ```go build```
### Utilisation de flag
- ```go build```

### Extensions

- schéma de serveur-clients
- explication extensions


## Extensions

|                                 Extension                                 |                                                                                                                   Localisation client                                                                                                                   |                                                                                    Localisation serveur                                                                                     |                       Temps de réalisation                        |                                                                                                                                                                                                                                                                                                                                        Commentaires                                                                                                                                                                                                                                                                                                                                         |
|:-------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:-----------------------------------------------------------------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|
|           Affichage du nombre de joueurs sur l'écran d'accueil            |                      game-update.go dans la fonction `HandleWelcomeScreen()` entre les lignes 39 à 41.<br/>game-draw.go entre les lignes 34 à 53.<br/>game-draw.go dans la méthode `DrawWelcomeScreen()` entre les lignes 34 à 53.                      |                                                       network/server/server-tcp.go dans la fonction `acceptClients()` à la ligne 61.                                                        | Juste pour l'écran d'accueil ~1h30.<br/>Au total entre 2h et 2h30 |                                                                                                                                                                                                                                              Nous avons complété cette extension en ajoutant d'autres compteur d'attente aux écran de choix des runner et à la fin d'une course en attendant que les 4 joueurs souhaitent relancer une partie.                                                                                                                                                                                                                                              |
|           Voir la sélection des personnages des autres joueurs            |                              game-update.go dans la fonction `ChooseRunners()` entre les lignes 53 à 58 et entre les lignes 76 à 81<br/>Dans runner.go, ajout d'une nouvelle valeur de retour entre les lignes 105 à 122.                               |                                                                     network/server/server-tcp.go lignes à la ligne 103.                                                                     |                            ~45 minutes                            |                                                                                                                                                                                                                      Une nouvelle variable de retour a été ajouté à la méthode `ManualChoose()` dans le fichier runner.go et renvoie true si la sélection du runner a changer. On envoie le runner sélectionné au serveur uniquement si le choix du joueur a changer.                                                                                                                                                                                                                       |
|          Un personnage ne peut être sélectionné par deux joueurs          | game-update.go dans la fonction `ChooseRunners()` entre les lignes 53 à 58 et entre les lignes 76 à 81.<br/>Dans runner.go ajout d'une variable de retour indiquant si la sélection s'effectue vers la gauche ou la droite, entre les lignes 105 à 122. |                                                                        network/server/server-tcp.go lignes 87 à 104                                                                         |                                ~2h                                | Le serveur stocke un tableau ayant pour chaque index (clientID) l'index du runner sélectionné par le client. La goroutine de communication, lorsqu'elle reçoit un message de son client, vérifie que le nouveau joueur sélectionné n'est pas déjà sélectionné par un autre joueur. En fonction de si le joueur effectuait une sélection vers la gauche ou la droite, cherches le joueur non sélectionné le plus proche dans cette même direction. Une fois un runner non sélectionné trouvé, la sélection du runner est en envoyé à tous les clients. Ainsi, le client venant de choisir son runner, se voit également réassigner la position de son curseur après vérification du serveur. |
|          Permettre à un joueur de changer de choix de personnage          |                                                                                       game-update.go dans la méthode `ChooseRunners()` entre les lignes 63 à 66.                                                                                        |                                                                       network/server/server-tcp.go lignes 109 à 119.                                                                        |                              32000ms                              |                                                                                                                                                                                                                Lorsque le client appuie sur la barre espace, est envoyé au serveur un booléen permettant de savoir si le runner a été sélectionné ou désélectionné. Le serveur incrémente ou décrémente alors un compteur. Quand celui-ci est égal à 4, la partie commence.                                                                                                                                                                                                                 |
|               Temps des runner est celui des autres joueurs               |                                                     game-update.go dans la fonction `multiplayerGame()` entre les lignes 262 à 269 et dans la fonction `CheckArrival()` entre les lignes 128 à 133.                                                     |                                                                        network/server/server-tcp.go ligne 129 à 143.                                                                        |                               ~2h30                               |                                                                                                                                                                                                                          A la fin de sa course, le client envoie au serveur son temps. Le serveur attend de recevoir le temps des 4 joueurs puis envoie un message contenant les 4 temps à tous les clients. Les clients affectent ensuite ces temps aux runners.                                                                                                                                                                                                                           |
| Remplacer le comportement des bots par le comportement des autres joueurs |                                                             game_update.go dans la fonction `multiplayerGame()` entre les lignes 250 à 261 et dans la fonction `UpdateRunners()` ligne 119.                                                             |                                                                        network/server/server-tcp.go ligne 165 à 169.                                                                        |                                ~2h                                |                                                                                                                                                                 Un client envoie sa position au serveur au format `character_info/clientID/position` (les informations ne sont pas séparés par le caractère "/", il a été mis par question de lisibilité). Le serveur envoie cette information à tous les autres clients.<br/>La gestion de cette information coté client est gérée dans la goroutine `multiplayerGame()`.                                                                                                                                                                  |
|                        Identification des joueurs                         |                                                                                   game.go après l'initialisation de la communication avec le serveur ligne 102 à 106.                                                                                   |                                                network/server/server-tcp.go ligne 60 dans la fonction acceptant les connections au serveur.                                                 |                                ~1h                                |                                                                                                                                                                                                                                                                                            Le serveur gère l'identification des joueurs. Le client s'affecte l'identifiant reçu par le serveur.                                                                                                                                                                                                                                                                                             |
|        Le serveur communique avec chaque client par une goroutine         |                           Les fonction de communication (lecture et écriture) se trouvent dans network/message-sender.go. Elles sont lancés en tant que goroutine dans game.go aux lignes 98 et 99 lors de l'initialisation.                            |           network/server/server-tcp.go dans la boucle for ligne 152 à 155. Les goroutines de communication sont lancés depuis la fonction `acceptClients()` aux lignes 57 et 58.            |                                ~5h                                |                                                                                                                                                                   Le serveur lance une nouvelle goroutine de communication pour chaque client.<br/>On a donc 4 + (4*2) = 12 goroutines d'exécutés coté serveur quand tous les joueurs sont connectés et 2 goroutines coté client pour chaque client client connecté (8 au total).<br/>On pourrait alors étendre le jeu à un nombre de joueurs plus élevé très facilement.                                                                                                                                                                   |

Nous avons en priorité penser à une structure d'échange fiable qui nous permettra par la suite de réaliser simplement les extensions. Nos messages d'échanges commencent tous par un caractère définit dans `network/codes.go` permettant d'identifier le type d'information à gérer et ainsi pouvoir la gérer correctement que ce soit coté client ou serveur.

Avec ce système, nous pouvons alors des conditions comme celle-ci :
```go
select {
	case message := <-g.readChan:
		if message == network.ALL_CONNECTED {
			// Some code.
		}

		if message[:1] == network.CLIENTS_IN_QUEUE && !g.readyNextStep {
			// Some code.
		}
	default:
	}
```